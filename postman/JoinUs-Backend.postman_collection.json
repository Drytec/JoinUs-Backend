{
  "info": {
    "name": "JoinUs Backend API",
    "_postman_id": "b8c08ab4-4d0c-4ee5-9c21-78c452e91b74",
    "description": "Colección Postman para interactuar con el backend de JoinUs, cubriendo operaciones CRUD de usuarios y flujos de autenticación, cierre de sesión y restablecimiento de contraseña.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Listar usuarios",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/users",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "users"
          ]
        },
        "description": "Obtiene todos los usuarios registrados." 
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "  pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Almacenar ID de usuario para futuras solicitudes\", function () {",
              "  const responseJson = pm.response.json();",
              "  pm.expect(responseJson).to.be.an('array');",
              "  if (Array.isArray(responseJson) && responseJson.length > 0 && responseJson[0].id) {",
              "    pm.collectionVariables.set('userId', responseJson[0].id);",
              "  }",
              "});"
            ]
          }
        }
      ]
    },
    {
      "name": "Registrar usuario",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"{{userEmail}}\",\n  \"firstName\": \"{{firstName}}\",\n  \"lastName\": \"{{lastName}}\",\n  \"age\": {{age}},\n  \"password\": \"{{userPassword}}\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{baseUrl}}/api/users/register",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "users",
            "register"
          ]
        },
        "description": "Crea un nuevo usuario en Firebase Auth y Firestore." 
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Status code is 201\", function () {",
              "  pm.response.to.have.status(201);",
              "});",
              "",
              "pm.test(\"Respuesta incluye mensaje de éxito\", function () {",
              "  const responseJson = pm.response.json();",
              "  pm.expect(responseJson).to.have.property('message');",
              "});"
            ]
          }
        }
      ]
    },
    {
      "name": "Iniciar sesión",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"{{userEmail}}\",\n  \"password\": \"{{userPassword}}\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{baseUrl}}/api/users/login",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "users",
            "login"
          ]
        },
        "description": "Autentica al usuario y devuelve el token de Firebase." 
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "  pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Guardar token de sesión\", function () {",
              "  const responseJson = pm.response.json();",
              "  pm.expect(responseJson).to.have.property('token');",
              "  pm.collectionVariables.set('idToken', responseJson.token);",
              "  if (responseJson.data && responseJson.data.id) {",
              "    pm.collectionVariables.set('userId', responseJson.data.id);",
              "  }",
              "});"
            ]
          }
        }
      ]
    },
    {
      "name": "Cerrar sesión",
      "request": {
        "method": "POST",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/users/logout",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "users",
            "logout"
          ]
        },
        "description": "Finaliza la sesión activa del usuario en Firebase." 
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "  pm.response.to.have.status(200);",
              "});"
            ]
          }
        }
      ]
    },
    {
      "name": "Actualizar usuario",
      "request": {
        "method": "PUT",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{idToken}}",
            "disabled": true
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"firstName\": \"{{updatedFirstName}}\",\n  \"lastName\": \"{{updatedLastName}}\",\n  \"age\": {{updatedAge}}\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{baseUrl}}/api/users/update/{{userId}}",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "users",
            "update",
            "{{userId}}"
          ]
        },
        "description": "Actualiza los datos básicos del usuario identificado." 
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "  pm.response.to.have.status(200);",
              "});"
            ]
          }
        }
      ]
    },
    {
      "name": "Eliminar usuario",
      "request": {
        "method": "DELETE",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{idToken}}",
            "disabled": true
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/api/users/delete/{{userId}}",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "users",
            "delete",
            "{{userId}}"
          ]
        },
        "description": "Elimina al usuario especificado de Firestore y Firebase Auth." 
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "  pm.response.to.have.status(200);",
              "});"
            ]
          }
        }
      ]
    },
    {
      "name": "Solicitar restablecimiento de contraseña",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"{{userEmail}}\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{baseUrl}}/api/users/forgot-password",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "users",
            "forgot-password"
          ]
        },
        "description": "Genera un token de recuperación y envía el correo con instrucciones." 
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "  pm.response.to.have.status(200);",
              "});"
            ]
          }
        }
      ]
    },
    {
      "name": "Restablecer contraseña",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"token\": \"{{resetToken}}\",\n  \"password\": \"{{newPassword}}\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{baseUrl}}/api/users/reset-password",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "users",
            "reset-password"
          ]
        },
        "description": "Actualiza la contraseña del usuario validando el token de recuperación." 
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "  pm.response.to.have.status(200);",
              "});"
            ]
          }
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:5100"
    },
    {
      "key": "userEmail",
      "value": "user@example.com"
    },
    {
      "key": "firstName",
      "value": "Ada"
    },
    {
      "key": "lastName",
      "value": "Lovelace"
    },
    {
      "key": "age",
      "value": "28"
    },
    {
      "key": "userPassword",
      "value": "Password123"
    },
    {
      "key": "updatedFirstName",
      "value": "Ada"
    },
    {
      "key": "updatedLastName",
      "value": "Lovelace-Updated"
    },
    {
      "key": "updatedAge",
      "value": "30"
    },
    {
      "key": "userId",
      "value": ""
    },
    {
      "key": "idToken",
      "value": ""
    },
    {
      "key": "resetToken",
      "value": "PASTE_RESET_TOKEN_HERE"
    },
    {
      "key": "newPassword",
      "value": "NewPassword123"
    }
  ]
}
